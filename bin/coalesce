#!/usr/bin/env python

import sys
from collections import defaultdict
from pymongo import MongoClient


def midnight(dt):
    return dt.replace(hour=0, minute=0, second=0, microsecond=0)


def seconds_since_midnight(dt):
    mn = midnight(dt)
    return int((dt - mn).total_seconds())


def main():
    client = MongoClient()
    db = client.karmanaut

    for sample in db.samples.find():
        dt = sample['timestamp']
        ts = midnight(dt)
        secs = seconds_since_midnight(dt)
        q = {'user': sample['user'], 'timestamp': ts}
        doc = {"$set": {
            "link_karma.{:d}".format(secs): sample['link_karma'],
            "comment_karma.{:d}".format(secs): sample['comment_karma'],
        }}

    return 0


if __name__ == "__main__":
    sys.exit(main())
